{% extends 'extends/setup_interface.html' %}

{% block title %}
  List of Equipments
{% endblock %}

{% block section_title %}
  PRINTING PRESS EQUIPMENTS
{% endblock %}

{% block section_des %} 
  Add some equipement in the database. Be sure to put the name of brand or variations.<br> 
  Fields marked with <span class="font-bold text-red-500">*</span> are required.
{% endblock %}

{% block form_heading %} Add Equpiments Data {% endblock %}

{% comment %} Setting variables that the parent utilize  {% endcomment %}
{% block left_section_var %}
  {% with panel_id="equipments_form" prev_background="linear-gradient(45deg, #2d6a4f, #d97706)" next_background="linear-gradient(to bottom right, #4b5563, #047857)"%}
    {{block.super}}
  {% endwith %}
{% endblock left_section_var %}
{% block form_block%}
  {% with form_id="equipments_form" next_url='inventory_and_category' prev=True prev_url='services_and_pricing'%}
    {{block.super}}
  {% endwith %}
{% endblock %}

{% block form_fields %}
  <div class="space-y-4 w-full">
    <div>
        <label for="name" class="mb-2 block text-sm font-semibold text-gray-700">
          Equipment Name: <span class="text-red-500">*</span>
        </label>
        <div class="input relative">
          <div class="absolute top-0 left-0 h-full flex items-center justify-center w-12">
              <i class="fas fa-tools text-lg text-green-600 transition-all duration-600 ease-in-out"></i> 
          </div>
          <input type="text" id="name" name="name" class="w-full pl-12 py-3 pr-3 border rounded-lg focus:ring-green-500 focus:border-green-500" autocomplete="off" 
            placeholder="Input an equipment name." required>
        </div>
        
          {% if form.name.errors %}
              <div class="error text-red-500">
                  {% for error in form.name.errors %}
                      <p>{{ error }}</p>
                  {% endfor %}
              </div>
          {% endif %}

        <!-- Custom dropdown for equipment -->
        <div id="equipment-dropdown" class="dropdown hidden mt-2 border border-gray-300 max-h-36 overflow-y-auto absolute w-[90%] bg-white z-10">
            <!-- Options will be populated dynamically -->
        </div>

        <div id="custom-equipment-prompt" class="hidden mt-2 text-sm text-gray-700">
            <button type="button" id="add-custom-equipment" class="px-4 py-2 bg-green-600 text-white rounded-lg">
              <i class="fas fa-plus-circle"></i> Add Custom Equipment
            </button>
        </div>
    </div>

    <div>
        <label for="description" class="mb-2 block text-sm font-semibold text-gray-700">
          Brand/Variation: <span class="text-red-500">*</span>
        </label>
        <div class="input relative">
          <div class="absolute top-0 left-0 h-full flex items-start pt-4 justify-center w-12">
              <i class="fas fa-tag text-lg text-green-600 transition-all duration-600 ease-in-out"></i> 
          </div>
          <textarea id="description" name="description" rows="4" class="w-full pl-12 py-3 pr-3 border rounded-lg focus:ring-green-500 focus:border-green-500"
            placeholder="Enter equipment description...." required></textarea>
        </div>
       
    </div>

    <div>
        <label for="condition" class="block text-sm font-semibold text-gray-700">
          <i class="fas fa-info-circle text-green-600"></i> Condition: <span class="text-red-500">*</span>
        </label>
        <select id="condition" name="condition" class="w-full mt-1 p-3 border rounded-lg focus:ring-green-500 focus:border-green-500" required>
            <option value="" disabled selected>What's the equipment current condition?</option>
            <option value="new">New</option>
            <option value="working">Working</option>
            <option value="damaged">Damaged</option>
            <option value="broken">Broken</option>
        </select>
    </div>
  </div>

  <div class="mt-8 flex justify-end">
    <button type="submit" class="px-6 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 focus:ring-2 focus:ring-green-500">
      <i class="fas fa-check-circle"></i> Add Equipment
    </button>
  </div>

<script>
  $(document).ready(function () {
    const equipmentList = [
        'Printer', 'Cutter', 'Heat Press', 'Plotter', 'Screen Printing Kit', 'Embroidery Machine',
        'T-Shirt Printing Press', 'UV Printer', 'Laser Cutter', 'Cutting Plotter', 'Solvent Printer', 
        'Laminating Machine', 'Binding Machine', 'Vinyl Cutter', 'Sublimation Printer', 'Foiling Machine',
        'Offset Printer', 'Flexographic Printer', 'Digital Press', 'Inkjet Printer', 'Thermal Transfer Printer',
        'Paper Folding Machine', 'Binding Press', 'Stamping Machine', 'Packaging Machine', 'Calendaring Machine',
        'Wide Format Printer', 'Label Printer', 'Folding Machine', 'Roll-to-Roll Printer', 'UV Coating Machine',
        'Hot Stamping Machine', 'Screen Printing Press', 'Vinyl Transfer Machine', 'Printing Plate Maker', 
        'Solvent Ink Printer', 'Direct-to-Garment Printer', 'DTF Printer', 'Transfer Paper Printer', 
        'Embossing Machine', 'Pad Printer', 'Laser Engraving Machine', 'Laser Etching Machine', 'Print Finishing Equipment',
        'Calendaring Machine', 'Flatbed Printer', 'Film Processor', 'Varnish Printer', 'Cold Laminator',
        'Web Printing Press', 'Digital Label Printer', 'Heat Transfer Press', 'Cutting Machine', 'Ink Mixer',
        'Toner', 'Plate Making Machine', 'Direct Printing Machine', 'Varnishing Machine', 'Folding & Gluing Machine',
        'Rotary Die Cutter', 'Foil Stamping Machine', 'Post-Press Equipment', 'Cylindrical Printing Machine', 'UV LED Printer',
        'Other'
    ];

    const inputField = document.getElementById('name');
    const dropdown = document.getElementById('equipment-dropdown');
    const customPrompt = document.getElementById('custom-equipment-prompt');
    const addCustomEquipmentBtn = document.getElementById('add-custom-equipment');

    inputField.addEventListener('input', function() {
        const value = this.value.toLowerCase();

        // Clear the dropdown every time user types something
        dropdown.innerHTML = '';

        // Filter equipment based on input
        const filteredList = equipmentList.filter(equipment => equipment.toLowerCase().includes(value));

        if (filteredList.length > 0) {
            // Show filtered options in the dropdown
            filteredList.forEach(equipment => {
                const option = document.createElement('div');
                option.textContent = equipment;
                option.classList.add('dropdown-item');
                option.addEventListener('click', function() {
                    inputField.value = equipment;
                    customPrompt.classList.add('hidden');  // Hide custom prompt
                });
                dropdown.appendChild(option);
            });

            // Show the dropdown if there are results
            dropdown.classList.remove('hidden');
        } else {
            // Show the "Add Custom Equipment" prompt if no results match
            dropdown.classList.add('hidden');
            customPrompt.classList.remove('hidden');
        }
    });

    // Hide dropdown when the input is not focused
    inputField.addEventListener('blur', function() {
        setTimeout(() => {
            dropdown.classList.add('hidden');
        }, 250);
    });

    // Handle adding custom equipment
    addCustomEquipmentBtn.addEventListener('click', function() {
        const customName = inputField.value.trim();
        if (customName && !equipmentList.includes(customName)) {
            equipmentList.push(customName);  // Add custom equipment to the list
            const option = document.createElement('div');
            option.textContent = customName;
            option.classList.add('dropdown-item p-8 cursor-pointer');
            option.addEventListener('click', function() {
                inputField.value = customName;
                dropdown.innerHTML = '';  // Clear dropdown after selection
                customPrompt.classList.add('hidden');  // Hide custom prompt
            });
            dropdown.appendChild(option);
            inputField.value = customName;  // Set custom value to input field
            customPrompt.classList.add('hidden');  // Hide the button
        }
    });
  });
</script>
<style>
  .dropdown-item {
    padding: 4px 8px;
    cursor: pointer;
  }
  .dropdown-item:hover {
      background-color: #f0f0f0;
  }
</style>
{% endblock %}

{% block messages %}
  {% if messages %}
  <div 
    id="success-message" 
    class="absolute bottom-4 left-10 z-50 px-4 py-2 text-green-800 bg-green-200 border border-green-300 rounded shadow-lg">
    {% for message in messages %}
      {{ message }}
    {% endfor %}
  </div>
  {% endif %}
  
  <script>
    // Fade out the success message after 3 seconds
    document.addEventListener('DOMContentLoaded', function () {
      const successMessage = document.getElementById('success-message');
      if (successMessage) {
        setTimeout(() => {
          successMessage.style.transition = 'opacity 0.5s ease';
          successMessage.style.opacity = '0';
          setTimeout(() => successMessage.remove(), 500); // Remove after fade-out
        }, 3000); // 3 seconds delay before starting fade-out
      }
    });
  </script>
{% endblock messages %}
  
                  
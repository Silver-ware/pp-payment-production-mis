{% load dyurl %}

{% if submit_btn %}
  <div class="flex items-center space-x-2">
    {% if prev %}
      <a href="{% dynamic_url prev_url %}" 
        class="hover:scale-105 flex items-center gap-2 bg-gray-500 text-white py-2 px-6 rounded-lg hover:bg-gray-600 focus:ring-4 focus:ring-gray-300 transition duration-200 shadow-md">
      <i class="fas fa-arrow-left"></i> Back
      </a>
    {% endif %}
    <button type="submit" form="{{form_id}}" 
          class="hover:scale-105 flex items-center gap-2 bg-green-500 text-white py-2 px-6 rounded-lg hover:bg-green-600 focus:ring-4 focus:ring-green-300 transition duration-200 shadow-md">
        {% if  last_submit %}
          <i class="fas fa-cogs"></i> Save Data & Settings
        {% else %}
          <i class="fas fa-paper-plane"></i> Submit
        {% endif %}
    </button>
  </div>
{% else %}
  <div class="flex items-center space-x-2">
    {% if prev %}
      <a href="{% dynamic_url prev_url %}" 
         class="hover:scale-105 flex items-center gap-2 bg-gray-500 text-white py-2 px-6 rounded-lg hover:bg-gray-600 focus:ring-4 focus:ring-gray-300 transition duration-200 shadow-md">
        <i class="fas fa-arrow-left"></i> Back
      </a>
    {% endif %}
    <div class="relative inline-block">
      <a id="next" href="{% dynamic_url next_url %}" 
         class="hover:scale-105 hover:bg-green-700 flex items-center gap-2 bg-green-500 text-white py-2 px-6 rounded-lg shadow-md">
        Next <i class="fas fa-arrow-right"></i>
      </a>
      <div id="lock" class="absolute inset-0 bg-gray-700 bg-opacity-50 flex items-center justify-center rounded-lg opacity-100 transition-opacity duration-500">
        <i class="fas fa-lock text-white text-2xl"></i>
      </div>
      {% if unlocked %}
        <script>
          $(document).ready(function () {
            var pageId = window.location.pathname;
            
            if (!sessionStorage.getItem(pageId + '_animationComplete') || sessionStorage.getItem('formSubmitted')) {
              console.log("animate");
              $("#lock").fadeOut(1000, function () {
                $(this).remove();
                $('#next').css('transition', 'transform 0.5s ease') 
                  .css('transform', 'scale(1.3)') 
                  .delay(500) 
                  .queue(function (next) {
                    $(this).css('transform', 'scale(1)')
                    .removeAttr('style');
                    next();
                  });
        
                sessionStorage.setItem(pageId + '_animationComplete', 'true');
              });
            }else{
              console.log("Done animating!");
              $("#lock").remove(); 
            }
          });
        </script>
      {% else %} 
        {% comment %} Reset the Flag {% endcomment %}
        <script>
          $(document).ready(function () {
            var pageId = window.location.pathname;
            sessionStorage.setItem(pageId + '_animationComplete', 'false');
          });
        </script>           
      {% endif %}
    </div>    
  </div>
{% endif %}
